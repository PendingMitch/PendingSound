<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PendingSound</title>
  </head>
  <body>
    <script>
      let Audios = [];
      window.addEventListener("message", function (event) {
        if (event.data.type !== "PlaySound") return;

        if (!event.data?.audioFile) {
          console.error("Need event information: audioFile");
          return null;
        }

        let id = Audios.length;
        let url = event.data.audioFile;

        if (!url.includes("http")) url = `./sounds/${event.data.audioFile}`;
        let volume = event.data?.volume;

        playAudio(id, url, volume);
      });

      function playAudio(id, audioFile, volume) {
        if (typeof id !== "number") {
          console.error(`id is type ${typeof id}. Must be a number.`);
          return null;
        }
        if (typeof audioFile !== "string") {
          console.error(
            `audioFile is type ${typeof audioFile}. Must be a string.`
          );
          return null;
        }

        if (typeof volume !== "number") volume = 1;

        Audios[id] = new Audio(audioFile);
        Audios[id].volume = volume;
        Audios[id].play();

        Audios[id].addEventListener("ended", function () {
          Audios.splice(id, 1);
        });

        console.log(`Now playing an audio named ${audioFile} under id ${id}`);
      }

      function stopAudio(audio) {
        if (typeof audio?.pause !== "function") {
          console.error("audio is not an audio type.");
          return null;
        }

        audio.pause();
      }
    </script>
  </body>
</html>
